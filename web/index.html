<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loadcell Datalogger</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="header">
        <div class="header__title">
            <svg class="header__logo" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="4" y="8" width="24" height="16" rx="2" stroke="currentColor" stroke-width="2" />
                <path d="M8 16h16M16 12v8" stroke="var(--accent-green)" stroke-width="2" stroke-linecap="round" />
                <circle cx="16" cy="16" r="3" fill="var(--accent-blue)" />
            </svg>
            Loadcell Datalogger
        </div>
        <span class="mode-badge mode-badge--user" id="current-mode">USER</span>
    </header>

    <div class="container">
        <!-- Status Overview -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">System Status</h2>
                <div class="status-bar">
                    <span class="status-dot status-dot--success status-dot--pulse" id="status-dot"></span>
                    <span id="status-text">Online</span>
                </div>
            </div>

            <div class="grid grid--4">
                <div class="stat-card card">
                    <div class="stat-card__value stat-card__value--green" id="stat-mode">USER</div>
                    <div class="stat-card__label">Current Mode</div>
                </div>
                <div class="stat-card card">
                    <div class="stat-card__value stat-card__value--blue" id="stat-wifi">ON</div>
                    <div class="stat-card__label">WiFi</div>
                </div>
                <div class="stat-card card">
                    <div class="stat-card__value" id="stat-logging">IDLE</div>
                    <div class="stat-card__label">Logging</div>
                </div>
                <div class="stat-card card">
                    <div class="stat-card__value stat-card__value--green" id="stat-sd">OK</div>
                    <div class="stat-card__label">SD Card</div>
                </div>
            </div>
        </div>

        <!-- Mode Selection -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Select Mode</h2>
            </div>

            <div class="grid grid--3">
                <!-- User Mode -->
                <div class="card" style="border-color: var(--mode-user);">
                    <h3 style="color: var(--mode-user);">
                        <span class="status-dot" style="background: var(--mode-user);"></span>
                        User Mode
                    </h3>
                    <p>Normal operation mode for viewing logged data and monitoring.</p>
                    <ul style="color: var(--text-secondary); margin: 1rem 0; padding-left: 1.5rem;">
                        <li>View live data charts</li>
                        <li>Browse log files</li>
                        <li>Check SD card storage</li>
                        <li>Monitor battery level</li>
                    </ul>
                    <button class="btn btn--primary btn--block" onclick="switchMode('user')">
                        Enter User Mode
                    </button>
                </div>

                <!-- Field Admin Mode -->
                <div class="card" style="border-color: var(--mode-admin);">
                    <h3 style="color: var(--mode-admin);">
                        <span class="status-dot" style="background: var(--mode-admin);"></span>
                        Field Admin Mode
                    </h3>
                    <p>Configuration and calibration for field technicians.</p>
                    <ul style="color: var(--text-secondary); margin: 1rem 0; padding-left: 1.5rem;">
                        <li>Load cell calibration</li>
                        <li>ADC PGA gain settings</li>
                        <li>IMU G-range / Gyro DPS</li>
                        <li>Save to device memory</li>
                    </ul>
                    <button class="btn btn--secondary btn--block" onclick="switchMode('admin')"
                        style="border-color: var(--mode-admin); color: var(--mode-admin);">
                        üîí Enter Admin Mode
                    </button>
                </div>

                <!-- Factory Mode -->
                <div class="card" style="border-color: var(--mode-factory);">
                    <h3 style="color: var(--mode-factory);">
                        <span class="status-dot" style="background: var(--mode-factory);"></span>
                        Factory Mode
                    </h3>
                    <p>End-of-line testing after board assembly.</p>
                    <ul style="color: var(--text-secondary); margin: 1rem 0; padding-left: 1.5rem;">
                        <li>Test ADC (MAX11270)</li>
                        <li>Test IMU (LSM6DSV)</li>
                        <li>Test RTC (RX8900CE)</li>
                        <li>Test SD Card & NeoPixel</li>
                    </ul>
                    <button class="btn btn--secondary btn--block" onclick="switchMode('factory')"
                        style="border-color: var(--mode-factory); color: var(--mode-factory);">
                        üîí Enter Factory Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Quick Actions</h2>
            </div>

            <div class="flex gap-md">
                <button class="btn btn--success" id="btn-start-log" onclick="toggleLogging()">
                    ‚ñ∂ Start Logging
                </button>
                <button class="btn btn--secondary" onclick="location.href='user.html'">
                    üìä View Dashboard
                </button>
                <button class="btn btn--secondary" onclick="refreshStatus()">
                    üîÑ Refresh Status
                </button>
            </div>
        </div>

        <!-- Device Info -->
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Device Information</h2>
            </div>

            <div class="grid grid--2">
                <div>
                    <p><strong>Model:</strong> <span id="info-model">Loadcell Datalogger v1.0</span></p>
                    <p><strong>MCU:</strong> <span id="info-mcu">ESP32-S3</span></p>
                    <p><strong>Firmware:</strong> <span id="info-firmware">1.0.0</span></p>
                </div>
                <div>
                    <p><strong>Uptime:</strong> <span id="info-uptime">--</span></p>
                    <p><strong>Free Heap:</strong> <span id="info-heap">--</span></p>
                    <p><strong>IP Address:</strong> <span id="info-ip">192.168.4.1</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recovery Modal -->
    <div id="recovery-modal" class="modal" style="display: none;">
        <div class="modal-backdrop" onclick="hideRecoveryModal()"></div>
        <div class="modal-content"
            style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid #f59e0b; max-width: 500px;">
            <div style="text-align: center; padding: 1.5rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                <h2 style="color: #f59e0b; margin-bottom: 1rem;">Incomplete Session Detected</h2>
                <p style="color: #94a3b8; margin-bottom: 1.5rem;">
                    A previous logging session was interrupted. Would you like to resume or start fresh?
                </p>
                <div class="flex gap-md" style="justify-content: center;">
                    <button class="btn btn--success" onclick="recoverSession()">
                        Resume Logging
                    </button>
                    <button class="btn btn--secondary" onclick="clearRecovery()">
                        Discard & Start Fresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            position: relative;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
    </style>

    <script type="module" src="app.js"></script>
    <script type="module" src="js/index-page.js"></script>
</body>

</html>